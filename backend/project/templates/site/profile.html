{% extends 'site/layout.html' %}
{% block title %} پنل کاربری {% endblock %}
{% block content %}
<div class="content-page woocommerce">
	<div class="container" id="app">
		<div v-cloak class="row">
			<div class="col-md-12">
				<!-- <h2 class="title-shop-page">پنل کاربری</h2> -->
				<div id="tabMenu" class="tab_container">
						<input class="tabinput" id="tab1" type="radio" name="tabs" @click="tab_selector='default'" :checked="is_active_tab('default')">
						<label class="tablabel" for="tab1"><i class="fa fa-dashboard"></i><span>داشبورد</span></label>

						<input class="tabinput" id="tab2" type="radio" name="tabs" @click="tab_selector='modify'" :checked="is_active_tab('modify')">
						<label class="tablabel" for="tab2"><i class="fa fa-pencil-square-o"></i><span>ویرایش اطلاعات</span></label>

						<input class="tabinput" id="tab3" type="radio" name="tabs" @click="tab_selector='sendmessage'" :checked="is_active_tab('sendmessage')">
						<label class="tablabel" for="tab3"><i class="fa fa-comments"></i><span>ارسال پیام</span></label>

						<input class="tabinput" id="tab4" type="radio" name="tabs" @click="tab_selector='payments'" :checked="is_active_tab('payments')">
						<label class="tablabel" for="tab4"><i class="fa fa-legal"></i><span>پرداختی ها</span></label>

						<input class="tabinput" id="tab5" type="radio" name="tabs" @click="tab_selector='invitor'" :checked="is_active_tab('invitor')">
						<label class="tablabel" for="tab5"><i class="fa fa-code"></i><span>کد معرف</span></label>

						<input class="tabinput" id="tab6" type="radio" name="tabs" @click="tab_selector='walet'" :checked="is_active_tab('walet')">
						<label class="tab6 tablabel" for="tab6"><span>شارژ موجودی</span></label>

						<input class="tabinput" id="tab7" type="radio" name="tabs" @click="tab_selector='changepass'" :checked="is_active_tab('changepass')">
						<label class="tablabel" for="tab7"><i class="fa fa-key"></i><span>تغییر رمز عبور</span></label>

						<section id="content1" class="tab-content">
							<h3>داشبورد</h3>
							<div class="row">
								{%raw%}
									<div class="col-lg-6 col-md-6">
										<div class="panel panel-primary">
										<div class="panel-heading">
											<div class="row">
											<div class="col-xs-3">
												<i class="fa fa-usd fa-5x"></i>
											</div>
											<div class="col-xs-9 text-right">
												<div class="huge">{{_ToPersianCurrency(information.credit)}}</span> تومان</div>
												<div>موجودی</div>
											</div>
											</div>
										</div>
											<div class="panel-footer">
											<span class="pull-left">مبلغ موجود در حسابتان</span>
											<span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
											<div class="clearfix"></div>
											</div>
										</div>
									</div>
									<div class="col-lg-6 col-md-6">
										<div class="panel panel-primary">
										<div class="panel-heading">
											<div class="row">
											<div class="col-xs-3">
												<i class="fa fa-percent fa-5x"></i>
											</div>
											<div class="col-xs-9 text-right">
												<div class="huge">{{_ToPersianCurrency(total_discount)}}تومان</div>
												<div>تخفیف</div>
											</div>
											</div>
										</div>
											<div class="panel-footer">
											<span class="pull-left">تخفیف های گرفته شده از یونی بید</span>
											<span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
											<div class="clearfix"></div>
											</div>
										</div>
									</div>
									<div class="col-lg-3 col-md-6">
										<div class="panel panel-green">
										<div class="panel-heading">
											<div class="row">
											<div class="col-xs-3">
												<i class="fa fa-trophy fa-5x"></i>
											</div>
											<div class="col-xs-9 text-right">
												<div class="huge">{{_ToPersian(won_auctions)}}</div>
												<div>برنده</div>
											</div>
											</div>
										</div>
											<div class="panel-footer">
											<span class="pull-left">تعداد حراجی های برنده شده</span>
											<span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
											<div class="clearfix"></div>
											</div>
										</div>
									</div>
									<div class="col-lg-3 col-md-6">
										<div class="panel panel-yellow">
										<div class="panel-heading">
											<div class="row">
											<div class="col-xs-3">
												<i class="fa fa-shopping-cart fa-5x"></i>
											</div>
											<div class="col-xs-9 text-right">
												<div class="huge">{{_ToPersian(total_boughts)}}</div>
												<div>خرید</div>
											</div>
											</div>
										</div>
											<div class="panel-footer">
											<span class="pull-left">تعداد خرید های انجام شده</span>
											<span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
											<div class="clearfix"></div>
											</div>
										</div>
									</div>
									<div class="col-lg-3 col-md-6">
										<div class="panel panel-red">
										<div class="panel-heading">
											<div class="row">
											<div class="col-xs-3">
												<i class="fa fa-gavel fa-5x"></i>
											</div>
											<div class="col-xs-9 text-right">
												<div class="huge">{{_ToPersian(total_enrolled_auctions)}}</div>
												<div>حراجی ها</div>
											</div>
											</div>
										</div>
											<div class="panel-footer">
											<span class="pull-left">تعداد حراجی های شرکت کرده</span>
											<span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
											<div class="clearfix"></div>
											</div>
										</div>
									</div>
									<div class="col-lg-3 col-md-6">
										<div class="panel panel-purple">
										<div class="panel-heading">
											<div class="row">
											<div class="col-xs-3">
												<i class="fa fa-street-view fa-5x"></i>
											</div>
											<div class="col-xs-9 text-right">
												<div class="huge">{{_ToPersian(total_invitations)}}</div>
												<div>دعوت شدگان</div>
											</div>
											</div>
										</div>
											<div class="panel-footer">
											<span class="pull-left">تعداد دعوت شدگان توسط شما</span>
											<span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
											<div class="clearfix"></div>
											</div>
										</div>
									</div>
									</div>
								{%endraw%}
						</section>

						<section id="content2" class="tab-content">
									<h3>ویرایش اطلاعات</h3>
									<form class="form-my-account" @submit.prevent="_handle_submit_info">
										<div class="row">
											<div class="col-md-6 col-sm-6 col-ms-12">
												<div class="check-billing">
													{%raw%}
														<p><input  v-model="information.alias_name"  type="text"  onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" placeholder="نام مستعار" /></p>
														<p><input  v-model="information.first_name"  type="text"  onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" placeholder="نام"/></p>
														<p><input  v-model="information.last_name"   type="text"  onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" placeholder="نام خانوادگی"/></p>
														<p><input  v-model="information.work_place"  type="text"  onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" placeholder="محل کار"/></p>
														<p><input  v-model="information.email"       type="text"  onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" placeholder="پست الکترونیک"/></p>
													{%endraw%}
											</div>
										 </div>

										 <div class="col-md-6 col-sm-6 col-ms-12">
											 <div class="check-billing">
 												{%raw%}
													<p>
 													<select v-model="information.state" id="state">
														<option value="" disabled selected>--استان--</option>
 														<option v-for="state in states" v-bind:value="state.id" :selected="information.address && information.state == state.id" >{{ state.title }}</option>
 													</select>
 													</p>
													<p><input v-model="information.city" type="text" onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" placeholder="شهر *"/></p>
 													<p><input v-model="information.address" type="text" onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" placeholder="آدرس *"/></p>
 													<p><input v-model="information.postal_code" type="number"  onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" placeholder="کدپستی *"/></p>
													<p><input v-model="information.mobile" type="text" onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" placeholder="شماره همراه *"/></p>

 												{%endraw%}
 										</div>
 										</div>
									 </div>
										<!-- <h3>کد معرف</h3>
										<div class="row">
											<div class="col-md-6 col-sm-6 col-ms-12">
												<div class="">

														<p><input name="invitor-code" type="text" onblur="if (this.value=='') this.value = this.defaultValue" onfocus="if (this.value==this.defaultValue) this.value = ''" /></p>

													<p class="pText">
														این قسمت فقط یک بار قابل استفاده است و بعد از زدن کد، شما و معرف شما ۲۰ هزار تومان هدیه دریافت خواهید کرد.
													</p>
												</div>
											</div>
										</div> -->
										<h3>انتخاب آواتار</h3>
										<input type="hidden" id="avatar_index" name="avatar-index" value="">
										<div class="avatarUser">
											<img v-on:click="_change_avatar(avatar.name)" v-for="avatar in avatars" v-bind:src="'/static/images/avatars/'+avatar.name " v-bind:class="{'current': avatar.name == information.avatar }" />
										</div>
										<div class="my-profile-box register-content-box">
											<input type="submit" class="register-button save-change" name="register" value="ذخیره تغییرات">
										</div>
									</form>

									<div class="alert alert-danger error_alert hide">
										<a href="#" class="close" aria-label="close">×</a>
										<div class="error_container"></div>
									</div>
									<div class="alert alert-success alert-dismissable success_alert hide">
									<a href="#" class="close" aria-label="close">×</a>
									<div class="success_container"></div>
								</div>
						 </section>

						<section id="content3" class="tab-content overflow">
							<h3>ارسال پیام</h3>
							<div class="form-contact">
								<form class="form-my-account" @submit.prevent="_handle_submit_message">

									<div class="row">
										<div class="col-md-6 col-sm-4 col-xs-12">
											<input type="text" v-model="message.title" onfocus="if (this.value==this.defaultValue) this.value = ''" onblur="if (this.value=='') this.value = this.defaultValue" placeholder="عنوان پیام">
										</div>

										<div class="col-md-3 col-sm-4 col-xs-12">
											<select v-model="message.subject" id="subjects">
												<option v-for="subject in subjects" v-bind:value="subject.type">{%raw%}{{subject.title}}{%endraw%}</option>
											</select>
										</div>

										<div class="col-md-9 col-sm-9 col-xs-12">
											<textarea v-model="message.message" cols="30" rows="8" onfocus="if (this.value==this.defaultValue) this.value = ''" onblur="if (this.value=='') this.value = this.defaultValue" placeholder="متن پیام خود را بنویسید ..."></textarea>
											<input type="submit" value="ارسال پیام" />
											<!-- <input type="file" name="file" id="file" class="inputfile" data-multiple-caption="{count} files selected" multiple />
											<label for="file"><i class="fa fa-upload"></i><span>بارگزاری فایل ضمیمه</span></label> -->
										</div>
									</div>

									<div class="alert alert-danger error_alert hide sendmessage_error">
										<a href="#" class="close" aria-label="close">×</a>
										<div class="sendmessage_error_container"></div>
									</div>
									<div class="alert alert-success alert-dismissable success_alert hide sendmessage_success">
										<a href="#" class="close" aria-label="close">×</a>
										<div class="sendmessage_success_container"></div>
									</div>
								</form>
							</div>
							<table class="fold-table">
									<thead>
										<tr>
											<th>موضوع پیام</th>
											<th>عنوان</th>
											<th>تاریخ</th>
										</tr>
									</thead>
									{%raw%}
									<tbody v-payment v-for="msg in information.messages">
										<tr class="view">
											<td>{{_convertSubject(msg.subject)}}</td>
											<td>{{msg.title}}</td>
											<td>{{_toLocalDate(msg.date)}}</td>
										</tr>
										<tr class="fold">
											<td colspan="7">
												<div class="fold-content">
													<h4> متن پیام : </h4>
													<p>{{msg.message}}</p>
											</td>
										</tr>
									</tbody>
									</table>
									{%endraw%}

						</section>

						<section id="content4" class="tab-content overflow">
							<h3>پرداختی ها</h3>
							<table class="fold-table">
									<thead>
										<tr>
											<th>شماره فاکتور</th>
											<th>مبلغ</th>
											<th>تاریخ</th>
											<th>موضوع</th>
											<th>وضعیت</th>
											<th>روش پرداخت</th>
										</tr>
									</thead>
									{%raw%}
									<tbody v-payment v-for="payment in paymentsinfo">
										<tr class="view">
											<td>{{_ToPersian(payment.GUID)}}</td>
											<td>{{_ToPersianCurrency(payment.amount)}} تومان  </td>
											<td>{{_toLocalDate(payment.date)}}</td>
											<td>{{_convertType(payment.type)}}</td>
											<td>{{_convertStatus(payment.status)}}</td>
											<td>{{payment.method}}</td>
										</tr>
										<tr class="fold">
											<td colspan="7">
												<div class="fold-content">
													<h4> فاکتور خرید : {{payment.GUID}}</span></h4>
													<div v-for="message in  payment.messages">
														<p>{{message.title}} : {{message.message}}</p>
													</div>

												<template v-for="order in payment.orders">
														<table class="small-friendly">
															<thead>
																<tr>
																<th>محصول</th>
																<th>تعداد</th>
																<th>مبلغ واحد</th>
																<th>مبلغ کل</th>
																<th>تخفیف</th>
																<th>مبلغ پرداختی</th>
															</tr>
															</thead>
															<tbody>
																<tr>
																	<td>{{order.title}}</td>
																	<td>{{_ToPersian(order.total)}}</td>
																	<td>{{_ToPersianCurrency(order.main_price)}}</td>
																	<td>{{_ToPersianCurrency(order.total_price)}}</td>
																	<td>{{_ToPersianCurrency(order.discount)}}</td>
																	<td>{{_ToPersianCurrency(order.paid)}}</td>
																</tr>
															</tbody>
													   </table>
													  <template  v-if="order.shipment">

																<div class="checkout-wrap" v-if="order.shipment.status==500">
																		<ul class="checkout-bar">
																			<li class="active">سفارش</li>
																			<li class="next">تایید سفارش</li>
																			<li class="">انبارداری</li>
																			<li class="">تحویل پست</li>
																			<li class="">خریدار</li>
																		</ul>
																</div>

																<div class="checkout-wrap" v-if="order.shipment.status==400">
																		<ul class="checkout-bar">
																			<li class="visited first">سفارش</li>
																			<li class="active">تایید سفارش</li>
																			<li class="next">انبارداری</li>
																			<li class="">تحویل پست</li>
																			<li class="">خریدار</li>
																		</ul>
																</div>

																<div class="checkout-wrap" v-if="order.shipment.status==300">
																		<ul class="checkout-bar">
																			<li class="visited first">سفارش</li>
																			<li class="previous visited">تایید سفارش</li>
																			<li class="active">انبارداری</li>
																			<li class="next">تحویل پست</li>
																			<li class="">خریدار</li>
																		</ul>
																</div>

																<div class="checkout-wrap" v-if="order.shipment.status==200">
																		<ul class="checkout-bar">
																			<li class="visited first">سفارش</li>
																			<li class="previous visited">تایید سفارش</li>
																			<li class="previous visited">انبارداری</li>
																			<li class="active">تحویل پست</li>
																			<li class="next">خریدار</li>
																		</ul>
																</div>

																<div class="checkout-wrap" v-if="order.shipment.status==100">
																		<ul class="checkout-bar">
																			<li class="visited first">سفارش</li>
																			<li class="previous visited">تایید سفارش</li>
																			<li class="previous visited">انبارداری</li>
																			<li class="previous visited">تحویل پست</li>
																			<li class="active">خریدار</li>
																		</ul>
																</div>
															 </template>
												   </template>

												 <template v-if="payment.plan">
													 <table class="small-friendly">
															<thead>
																<tr>
																<th>پلن</th>
																<th>قیمت</th>
																<th>کوپن تخفیف</th>
																<th>تعداد پیشنهاد</th>
																<th>وضعیت شرکت کننده</th>
															</tr>
															</thead>
															<tbody>
																<tr>
																	<td>{{payment.plan.title}}</td>
																	<td>{{_ToPersianCurrency(payment.plan.price)}}</td>
																	<td>{{_ToPersianCurrency(payment.plan.discount)}}</td>
																	<td>{{_ToPersian(payment.plan.offers)}}</td>
																	<td>{{payment.plan.state}}</td>
																</tr>
															</tbody>
													   </table>

												 </template>

												</div>
											</td>
										</tr>
									</tbody>
									</table>
									{%endraw%}
						</section>

						<section id="content5" class="tab-content">
							<h3>کد معرفی</h3>
							<p>با دعوت از دوستان و آشنایان خود به یونی بید از طریق کد معرف خود، ۲۰ هزار تومان هدیه دو طرف از ما دریافت کنید! </p>
							<p>هدیه کد معرف، پس از اولین شرکت در حراجی توسط شخصی که معرفی شده اعمال میشود.</p>
							<div class="CodeM">کد معرف : {%raw%}{{information.username}}{%endraw%}</span></div>
						</section>

						<section id="content6" class="tab-content">
							<h3>شارژ موجودی</h3>
							<p>شما می توانید به هر اندازه که می خواهید موجودی حسابتان را شارژ کنید.</p>

								<table cellspacing="0" class="shop_table cart table">
									<tbody>
										<tr>
											<td class="actions" colspan="12">
												<label for="charge_amount">افزایش اعتبار : </label>
												<input type="text" v-model="charge_amount" v-on:keypress="isNumber($event)" placeholder="مبلغ ... " class="input-text">
												<input type="submit" value="پرداخت" class="button" @click="_ChargeWalet">
											</td>
										</tr>
									</tbody>
								</table>
						</section>

						<section id="content7" class="tab-content">
								<h3>تغییر رمز عبور</h3>
								<form class="form-my-account" @submit.prevent="_handle_submit_password">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-ms-12">
											<div class="check-billing">
												{%raw%}
													<div class="my-profile-box register-content-box">
														<div class="form-my-account">
															<p>
																<label for="current-password">جهت تغییر رمز عبور گذرواژه فعلی خود را وارد کنید :</label>
																<input v-model="auth.old_password" type="password" placeholder="رمز عبور فعلی"/>
															</p>
															<p>
																<label for="password">رمز عبور جدید خود را وارد کنید :</label>
																<input v-model="auth.new_password" type="password" placeholder="رمزعبور جدید(حداقل ۴ کاراکتر)"/>
															</p>
															<p>
																<label for="confirm-password">تکرار رمز عبور جدید خود را وارد کنید :</label>
																<input v-model="auth.confirm_password" type="password" placeholder="تکرار رمزعبور جدید(مشابه رمزعبور)"/>
															</p>
														</div>
													</div>

												{%endraw%}
										</div>
									</div>
								 </div>
									<div class="my-profile-box register-content-box">
										<input type="submit" class="register-button save-change" name="register" value="ذخیره تغییرات">
									</div>
								</form>

								<div class="alert alert-danger error_alert hide">
									<a href="#" class="close" aria-label="close">×</a>
									<div class="error_container"></div>
								</div>
								<div class="alert alert-success alert-dismissable success_alert hide">
								<a href="#" class="close" aria-label="close">×</a>
								<div class="success_container"></div>
							</div>

						</section>

				</div>

			</div>
		</div>
	</div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}

<script>

start_loading(loading_element);

var app = new Vue({
	el : "#app",

	data:{
		information :
		{
	    avatar : "",
	    alias_name : "",
	    first_name : "",
	    last_name : "",
	    work_place : "",
	    mobile : "",
	    email : "",
			state:0,
			city:"",
			address:"",
			postal_code:0
    },
		auth:{
			old_password:"",
			new_password:"",
			confirm_password:"",
			current_time: new persianDate(new Date()).format("dddd DD MMMM YYYY ساعت  HH:mm"),
		},
		message:{
			title:"",
			subject:1,
			message:"",
			date: new Date().toLocaleString(),
		},
		avatars : [] ,
		current_avatar : "",
		info : [] ,
		states : [] ,
		paymentsinfo : [] ,
		subjects : [] ,
		total_boughts : 0 ,
		total_discount : 0 ,
		total_enrolled_auctions: 0 ,
		total_invitations: 0 ,
		won_auctions: 0 ,
		invitation_code : "",
		charge_amount : 0,
		payment_id:0,
		tab_selector : "{{tab}}",
		is_number : false,
	},

	mounted: function(){

		axios.get("{{url_for('userinformation')}}")
			.then((response) => {
				this.avatars = response.data.avatars;
				this.information = response.data.user_information;
				if(response.data.user_address){
					this.information.address = response.data.user_address.address;
					this.information.state = response.data.user_address.state;
					this.information.city = response.data.user_address.city;
					this.information.postal_code = response.data.user_address.postal_code;
				}
				this.information.messages = response.data.messages;
				this.states = response.data.states;
				this.subjects = response.data.message_subjects;
				this.total_boughts = response.data.total_boughts;
				this.total_discount = response.data.total_discount;
				this.total_enrolled_auctions = response.data.total_enrolled_auctions;
				this.total_invitations = response.data.total_invitations;
				this.won_auctions = response.data.won_auctions;
				this.invitation_code = response.data.invitation_code;
			})
			.catch((response)=>{
				console.error(response);
			});

		axios.get("{{url_for('paymentsinfo',pagenum=1,pagesize=10)}}")
			.then((response) => {
				this.paymentsinfo = response.data;
			})
			.catch((error)=>{
				console.log(error.response.data);
			});
	},

	methods:{
		is_active_tab:function(tab) {

			if (tab == this.tab_selector){
				return true;
			}else {
				return false;
			}
		},

		isNumber: function(evt) {

      evt = (evt) ? evt : window.event;
      var charCode = (evt.which) ? evt.which : evt.keyCode;
			// if ((charCode > 31 && (charCode < 48 || charCode > 57)) && (charCode < 1776 || charCode > 1785) && charCode !== 46) {
      if ((charCode > 31 && (charCode < 48 || charCode > 57)) && charCode !== 46) {
        evt.preventDefault();
      } else {
				this.tab_selector = "walet";
        return true;
      }
    },

		_delete_last_payment:function(){
			axios.delete("{{url_for('userchargewalet')}}",
				{
					data:{"pid": this.payment_id},
					headers:
					{
						'Content-Type': 'application/json',
						"X-CSRF-TOKEN" : getCookie('csrf_access_token'),
					}
				}).then((response) => {
						swal({
							title: 'افزایش موجودی',
							text: response.data.message,
							type: 'success',
							confirmButtonColor: '#3085d6',
							confirmButtonText: 'باشه...',
						});
					})
					.catch((error)=>{
						swal(
							'مشکلی پیش اومد',
							error.response.data.reason,
							'error'
						);
					});
		},

		_ChargeWalet:function() {

			if (this.charge_amount == 0 || !parseInt(this.charge_amount)) {
				swal(
					'دقت در ورود اطلاعات',
					'لطفا در ورود مبلغ شارژ دقت کنید. توجه کنید که صفحه کلید شما باید در حالت انگلیسی قرار گرفته باشد',
					'error'
				);
				return ;
			}

			if (this.charge_amount %500 != 0) {
				swal(
					'دقت در ورود اطلاعات',
					'حداقل مبلغ شارژ کیف پول ۵۰۰تومان است و مبلغ شارژ مورد نظر باید ضریبی از ۵۰۰ تومان باشد',
					'error'
				);
				return ;
			}

			axios.post("{{url_for('userchargewalet')}}",
			{"charge_amount":this.charge_amount},
				{
					headers:
					{
						'Content-Type': 'application/json',
						"X-CSRF-TOKEN" : getCookie('csrf_access_token'),
					}
				}).then((response) => {

					this.payment_id = response.data.pid;

					swal({
						title: 'تایید شارژ کیف پول',
						text: response.data.text,
						type: 'success',
						confirmButtonColor: '#3085d6',
						confirmButtonText: 'بله پرداخت می کنم',
						showCancelButton: true,
						cancelButtonText: 'خیر منصرف شدم!',
						confirmButtonColor: '#3085d6',
						cancelButtonColor: '#d33',
						reverseButtons: true,

					}).then((result) => {
						if (result.value){
							if(response.data.type=="redirect_to_bank"){
								window.parent.location = "/confirm/payment/"+this.payment_id;
							}
						}
						else {
							this._delete_last_payment();
						}
					});

				})
				.catch((error)=>{
					swal(
						'مشکلی پیش اومد',
						error.response.data.reason,
						'error'
					);
				});
		},

		_ToPersian(number){
			return ToPersian(number);
		},

		_ToPersianCurrency(number){
			return ToPersian(formatCurrency(number));
		},

		_clearNames(input){
			return ClearifyNames(input)[0];
		},

		_change_avatar(name){
			this.information.avatar = name;
		},

		_toLocalDate(date){
			return new persianDate(new Date(new Date(date).format("yyyy/M/d HH:mm:ss","UTC"))).format("dddd DD MMMM YYYY ساعت HH:mm");
		},

		_convertStatus(status){

			// PAID = 100
	    // BANK = 200
	    // PAYING = 300
	    // ERROR = 400
	    // ABORT = 500
	    // UNPAID = 0

			switch (status) {
				case 100:
					return "پرداخت موفق";
					break;
				case 200:
					return "درحال پرداخت بانک";
					break;
				case 300:
					return "درحال تکمیل عملیات پرداخت";
					break;
				case 400:
					return "پرداخت ناموفق";
					break;
				case 500:
					return "لغو شده";
					break;
				default:
					return "پرداخت نشده";
				}
			},
			_convertType(type){

				// NOTITLE = 0
		    // PLAN = 1000
		    // WALET = 2000
		    // PRODUCT = 3000

				switch (type) {
					case "1000":
						return "خرید پلن حراجی";
						break;
					case "2000":
						return "شارژ کیف پول";
						break;
					case "3000":
						return "خرید محصول";
					case "4000":
						return "خرید رایگان";
						break;
					default:
						return "بدون عنوان";

				}
		},

		_convertSubject(subject){
			return this.subjects.find(x=>x.type==subject).title;
		},

		_handle_submit_info(){

			swal({
				title: 'تایید ثبت تغییرات حساب کاربری',
				text: 'از اعمال این تغییرات برای اطلاعات حساب کاربری خودتون مطمئنین؟',
				type: 'success',
				confirmButtonColor: '#3085d6',
				confirmButtonText: 'بله مطمئنم',
				showCancelButton: true,
				cancelButtonText: 'نه بیخیال...',
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				reverseButtons: true,

			}).then((result) => {
				start_loading(loading_element);

				if (result.value){

					var obj = this.information;

		      for (var propName in obj) {
		        if (obj[propName] === "null" || obj[propName] === undefined || obj[propName]==="" || obj[propName]===-1) {
		          delete obj[propName];
		        }
		      }

					axios.post("{{url_for('userinformation')}}",obj,
						{
							headers:
							{
								'Content-Type': 'application/json',
								"X-CSRF-TOKEN" : getCookie('csrf_access_token'),
							}
						}).then((response) => {
							stop_loading(loading_element);
							swal({
								title :'ثبت اطلاعات کاربر',
								text :response.data.message.text,
								type :'success',
							}).then((result) => {
								if (result.value){
									if(response.data.message.field=='relogin'){
										window.location = '/login';
									}
								}
							});
						})
						.catch((error)=>{
							stop_loading(loading_element);
							message = error.response.data.message['text'];
							swal(
								'مشکلی پیش اومد',
								message,
								'error'
							);
						});
				}
			});
		},

		_handle_submit_password(){
			start_loading(loading_element);

			var obj = this.auth;

      for (var propName in obj) {
        if (obj[propName] === "null" || obj[propName] === undefined || obj[propName]==="" || obj[propName]===-1) {
          delete obj[propName];
        }
      }

			axios.post("{{url_for('userchangepassword')}}",obj,
				{
					headers:
					{
						'Content-Type': 'application/json',
						"X-CSRF-TOKEN" : getCookie('csrf_access_token'),
					}
				}).then((response) => {

					stop_loading(loading_element);

					swal({
						title:'تغییر رمز عبور حساب کاربری',
						text:response.data.message.text,
						type:'success'
					}).then((result) => {
						// if (result.value && response.data.message.field=='relogin'){
						// 	window.location = '/login';
						// }
					});

				})
				.catch((error)=>{
					stop_loading(loading_element);
					swal(
						'مشکلی پیش اومد',
						error.response.data.message.text,
						'error'
					);
				});
		},

		_handle_submit_message(){
			start_loading(loading_element);
			this.message.date = new Date().toLocaleString();
			var obj = this.message;
      for (var propName in obj) {
        if (obj[propName] === "null" || obj[propName] === undefined || obj[propName]==="" || obj[propName]===-1) {
          delete obj[propName];
        }
      }

			axios.post("{{url_for('usercontactus')}}",obj,
				{
					headers:
					{
						'Content-Type': 'application/json',
						"X-CSRF-TOKEN" : getCookie('csrf_access_token'),
					}
				}).then((response) => {

					stop_loading(loading_element);
					this.information.messages.push({title:this.message.title,subject:this.message.subject,message:this.message.message,date:this.message.date});
					swal({
						title:'ارسال پیام',
						text:response.data.message.text,
						type:'success'
					}).then((result) => {
						if(result.value){

							this.message.title="";
							this.message.subject=1;
							this.message.message="";
						}
					});

				}).catch((error)=>{
					stop_loading(loading_element);
					if(error.response.data.message.text){
						swal(
							'مشکلی پیش اومد',
							error.response.data.message.text,
							'error'
						);
					}
					else {
						err = "";
						for (var propName in error.response.data.message) {
						 err = error.response.data.message[propName];
					  }

						swal(
							'مشکلی پیش اومد',
							 err,
							'error'
						);
					}



				});
		},

	},

	updated:function() {

		stop_loading(loading_element);

		$('.avatarUser img').click( function(){
		    if ( $(this).hasClass('current') ) {
		    } else {
		        $('img.current').removeClass('current');
		        $(this).addClass('current');
		    }
		});
	},

	directives:{
		payment:{
			inserted:function(el) {
				setTimeout(function () {
				},1000);
			}
		},
	}

});

$(document).on('click','.fold-table tr.view',function() {
	console.log('fold');
	if($(this).hasClass("open")) {
	$(this).removeClass("open").next(".fold").removeClass("open");
	} else {
	$(".fold-table tr.view").removeClass("open").next(".fold").removeClass("open");
	$(this).addClass("open").next(".fold").addClass("open");
	}
});

</script>
{% endblock scripts %}
